---
title: "SimulationSAT"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(MASS)
```



```{r}
xy <- expand.grid(1:5, 1:5)
names(xy) <- c('x', 'y')
distance <- as.matrix(dist(xy, method = "euclidean"))
n <- nrow(xy) ##number of rows
eE <- rnorm(5*5, 0, 1) ## error component for explanatory variable
D <-0 ## just for now
muE <- eE + D ## mu for explanatory variable
rangeE <- 1 ## range for explanatory variable
psill = 0.05 
SAE <- mvrnorm(1, mu = muE, Sigma = psill * exp(-distance / rangeE)) ## SA term for explanatory variable
Beta = 0.4
eR <- rnorm(5*5, 0, 1) ## error term for response
muR <- Beta*SAE + eR ## mu for response 
rangeR = 2.5 ## range for response
SAR<- mvrnorm(1, mu = muR, Sigma = psill * exp(-distance / rangeR))
SAR ## ggplot dataframe to make a plot 

## next step wrap the entire thing into a function 
    
```



Simplified Simulation 
```{r}
SAT <- function (Beta=0, rangeR = 2.5, psill = 0.05, Nsimulation =10, Nrow = 5, Ncol = 5){
  N = 0 #The number of tests
  S = 0 #The number of times when p is less than 0.05
  pvalues<-c() # To store each pvalue from each test

  for(i in 1:Nsimulation){
    xy <- expand.grid(1:Nrow, 1:Ncol)
    names(xy) <- c('x', 'y')
    distance <- as.matrix(dist(xy, method = "euclidean"))
    npoints <- nrow(xy)
    D <-1:npoints ##Deterministic part (just for simplicity)
    muE <- D ## mu for explanatory variable
    muR <- Beta*D ## mu for response 
    SAR<- mvrnorm(1, mu = muR, Sigma = psill * exp(-distance / rangeR)+diag(x = 1, nrow =Nrow*Ncol, ncol = Nrow*Ncol ))
    rho <- cor(SAR, D)
    t<-rho*sqrt(npoints-2)/sqrt(1-rho^2) ## t stat
    p<- (1-pt(abs(t), npoints-2))*2 ##p-value
    if(0.05>= p){
      S = S +1 
    }
    pvalues[i] = p
    N = N+1 
  }
  output <- list(S/N, pvalues)
  names(output) <- c("Proportion", "p-values")
  output
}
SAT(Beta=0, rangeR = 0.05, psill = 0.05, Nsimulation =100, Nrow = 5, Ncol = 5)

```


For Upcoming Week

1. Start adding other components into the equation 
gradients x gradients as a coordinator 
y as a coordinator
original input for example x gradient, y gradient,use if statement inside the function. switch function for long if statements. 

autocorrelation for explanatory variable 
independent error component. diagnal matrix add the diagonal matrix into the existing sigma









